
* Discrete Class-D functional LTspice netlist (behavioral switches, functional verification)
* VCC = 24 V single supply, triangle carrier ~150 kHz, audio 1 kHz
* NOTE: This is a functional model for waveform verification. Replace behavioral sources
* and ideal switches with real MOSFET models and gate drivers for detailed loss/thermal sims.

***********************************************************************
* Power rails and reference
VCC VCC 0 DC 24
VREF REF 0 DC 12

* Audio source (AC coupled in real circuit). Here we shift audio by VREF
Vin IN 0 SIN(0 1.0 1k)        ; 1 V amplitude, 1 kHz tone
Baudio AUDIO 0 V=V(IN)+V(REF) ; audio centered at VREF

* Triangle / carrier generator approximated by a PULSE (sawtooth-ish)
* Period = 6.6667us -> ~150 kHz carrier
VTRI TRI 0 PULSE(0 2 0 1n 1n 3.333u 6.666u)

* PWM comparator (behavioral): produces VCC when AUDIO > TRI, else 0
Bcmp CMP 0 V= (V(AUDIO)-V(TRI) > 0 ? V(VCC) : 0)
* Complementary (inversion) for lower device (not strictly required if CMP is strictly complementary)
Bcmpn CMPN 0 V= (V(TRI)-V(AUDIO) > 0 ? V(VCC) : 0)

* Simple ideal switching model:
* For a functional sim we drive the half-bridge output node with the comparator level.
* BOUT outputs V(CMP) directly: when CMP=VCC -> out=VCC, when CMP=0 -> out=0.
Bout OUT 0 V=V(CMP)

* Output LC filter (reconstruction filter)
L1 OUT NODE_L 10uH
C1 NODE_L 0 4.7u
RLOAD NODE_L 0 8

* Snubber across half-bridge node to ground (optional)
Rsnub OUT SNUB 47
Csnub SNUB 0 100n

* Small series gate-sim resistor placeholder (for modeling slight transition)
Rseries OUT DRV 1meg

* Simulation control
.tran 0 10m 0 1u uic
.backanno
.end
